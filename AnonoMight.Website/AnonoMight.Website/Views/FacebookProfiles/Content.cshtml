@model AnonoMight.Website.Models.FacebookLinkModel
@using PagedList.Mvc
@{
    ViewBag.Title = Model.SiteInfo.Title;
}
@Html.Hidden("SiteName", Model.SiteInfo.Name)


<div class="row site-header">
    <div class="col-md-2"><img id="ProfileImage" src="@Url.Action("GetSiteImage", "Site", new  { SiteName = Model.SiteInfo.Name})" /></div>
    <div class="col-md-6">@Model.SiteInfo.Description</div>
    <div class="col-md-4" >
        <div class="col-md-4" >
        @if (Model.TopProfile != null)
        {
            <div class="row imageRow" data-id="@Model.TopProfile.Id">
                <div class="col-md-12 ">
                    <div class="imageContainer">
                        <div>
                            <div >&nbsp</div>
                            <div class="clear"></div>
                        </div>
                        <div>
                            <img class="img-rounded topPhoto" src="~/Images/1stplace.png" />
                        </div>


                    </div>

                </div>
            </div>
        }
    </div>

        <div class="col-md-8">
            @if (Model.TopProfile != null)
            {
                <div class="row imageRow" data-id="@Model.TopProfile.Id">
                    <div class="col-md-12 ">
                        <div class="imageContainer">
                            <div>
                                <div >@Model.TopProfile.Name </div>
                                <div class="clear"></div>
                            </div>
                            <div><img class="img-rounded topPhoto" src="data:image/jpg;base64,@Convert.ToBase64String(@Model.TopProfile.ProfileImage)" /></div>


                        </div>

                    </div>
                </div>
            }
        </div>
    </div>


</div>
@if (Model.ContentList.PageNumber == 1)
{
    <div class="row">
        <div class="col-md-10">
            <div class="form-group">
                <input type="text" id="FacebookLink" class="form-control" placeholder="Post a Facebook Profile link?" />
            </div>
        </div>
        <div class="col-md-2">
            <div class="form-group">
                <input type="button" id="SendFacebookLink" class="col-md-12 btn btn-default" value="Send" />
            </div>
        </div>
    </div>
}
<div class="table" id="Posts">
    @foreach (var item in Model.ContentList)
    {
        <div class="row imageRow" data-id="@item.Id">
            <div class="col-md-12 " >
                <div class="imageContainer">
                    <div>
                        <div>@item.Name </div>
                        <div class="clear"></div>
                    </div>
                    <div><img class="img-rounded" src="data:image/jpg;base64,@Convert.ToBase64String(item.ProfileImage)" /></div>
                    <div>
                        <div class="date">@item.TimeStamp.ToString("dd MMMM yyyy HH:mm") </div>
                        <div class="report"><a data-toggle="modal" data-target="#reportModal">Report</a></div>
                        <div class="clear"></div>
                    </div>

                </div>

            </div>
        </div>
    }


</div>
 Page @(Model.ContentList.PageCount < Model.ContentList.PageNumber ? 0 : Model.ContentList.PageNumber) of @Model.ContentList.PageCount
@Html.PagedListPager(Model.ContentList, page => string.Format("/{1}?page={0}", page, Model.SiteInfo.Name))



@section scripts {
    @if (Model.ContentList.PageNumber == 1)
    {
    <!--Script references. -->
    <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
    <!--Reference the SignalR library. -->
        <script src="~/Scripts/jquery.signalR-2.0.1.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
        <script src="~/signalr/hubs"></script>
    <!--SignalR script to update the chat page and send messages.-->
        <script>
            $(function () {
                // Reference the auto-generated proxy for the hub.
                var chat = $.connection.notificationHub;
                // Create a function that the hub can call back to display messages.
                chat.client.postFacebookLinkReceived = function (event) {
                    // Add the message to the page.
                    if ($("#Posts .row").length >= 10)
                        $("#Posts .row").last().remove();


                    var row =
                       '<div class="row imageRow" data-id="' + event.Id + '">' +
                           '<div class="col-md-12 " >' +
                               '<div class="imageContainer">' +
                                    '<div>' +
                                        '<div >' + event.Name + '</div>' +
                                        '<div class="clear"></div>' +
                                    '</div>' +
                                   '<div><img class="img-rounded" src="data:image/jpg;base64,' + event.ProfilePicture + '"/></div>' +
                                   '<div>' +
                                       '<div class="date">Now</div>' +
                                       '<div class="report"><a data-toggle="modal" data-target="#reportModal">Report</a></div>' +
                                       '<div class="clear"></div>' +
                                   '</div>' +

                               '</div>' +

                          '</div>' +
                       '</div>'

                    $('#Posts').prepend(row);
                };
                // Get the user name and store it to prepend to messages.
                // Set initial focus to message input box.
                $('#message').focus();
                // Start the connection.

                var siteName = '@(Model.SiteInfo.Name)';
                $.connection.hub.start().done(function () {
                    chat.server.addGroup({ siteName: siteName });

                    $('#SendFacebookLink').click(function () {
                        // Call the Send method on the hub.
                        chat.server.postFacebookLink({ siteName: siteName, Url: $('#FacebookLink').val() });
                        // Clear text box and reset focus for next comment.
                        $('#FacebookLink').val('').focus();
                    });
                });
            });

        </script>
    }
}

